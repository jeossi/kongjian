<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿåº§è¿åŠ¿æŸ¥è¯¢</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
            line-height: 1.5;
            font-weight: 400;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            margin: 0;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow-x: hidden;
        }

        .app {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .title {
            color: #fff;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            text-align: center;
        }

        .picker-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        /* ç»Ÿä¸€æ‹¨ç›˜å®¹å™¨æ ·å¼ */
        .picker-container-unified {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 12px;
            margin: 20px 0;
            flex-wrap: nowrap; /* å¼ºåˆ¶ä¸æ¢è¡Œ */
            overflow-x: auto; /* å¦‚æœå±å¹•å¤ªå°ï¼Œå…è®¸æ°´å¹³æ»šåŠ¨ */
            padding: 10px 0;
        }

        /* åˆ†éš”ç¬¦æ ·å¼ */
        .separator {
            color: white;
            font-size: 24px;
            font-weight: bold;
            margin: 30px 8px 0 8px;
            opacity: 0.7;
            flex-shrink: 0;
        }

        /* æ‹¨ç›˜åˆ—æ ·å¼ */
        .picker-column {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 2px;
            flex-shrink: 0; /* é˜²æ­¢æ”¶ç¼© */
        }

        .picker-label {
            color: white;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
            text-align: center;
        }

        .picker-wheel {
            background: linear-gradient(180deg, 
                rgba(255, 255, 255, 0.3) 0%, 
                rgba(255, 255, 255, 0.9) 15%, 
                rgba(255, 255, 255, 0.95) 50%, 
                rgba(255, 255, 255, 0.9) 85%, 
                rgba(255, 255, 255, 0.3) 100%);
            border-radius: 15px;
            padding: 0;
            min-width: 70px;
            width: 70px;
            height: 120px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            outline: none;
            /* å®Œå…¨éš”ç¦»æ»šåŠ¨è¡Œä¸º */
            overscroll-behavior: contain;
            touch-action: none;
            user-select: none;
            box-shadow: 
                0 8px 16px rgba(0, 0, 0, 0.15),
                inset 0 1px 0 rgba(255, 255, 255, 0.5),
                inset 0 -1px 0 rgba(0, 0, 0, 0.1);
        }

        /* å¹´ä»½æ‹¨ç›˜ä¿æŒè¾ƒå®½ */
        .picker-wheel.year-picker {
            min-width: 80px;
            width: 80px;
        }

        /* æœˆæ—¥æ—¶åˆ†æ‹¨ç›˜å˜çª„ */
        .picker-wheel.narrow-picker {
            min-width: 55px;
            width: 55px;
        }

        /* æ‹¨ç›˜ç„¦ç‚¹æ ·å¼ */
        .picker-wheel:focus {
            border-color: rgba(102, 126, 234, 0.8);
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.3);
        }

        .picker-wheel.time-picker:focus {
            border-color: rgba(255, 165, 0, 0.8);
            box-shadow: 0 0 0 2px rgba(255, 165, 0, 0.3);
        }

        /* æ—¶é—´æ‹¨ç›˜çš„åŒºåˆ«æ ·å¼ */
        .picker-wheel.time-picker {
            background: linear-gradient(180deg, 
                rgba(255, 223, 186, 0.3) 0%, 
                rgba(255, 223, 186, 0.9) 15%, 
                rgba(255, 223, 186, 0.95) 50%, 
                rgba(255, 223, 186, 0.9) 85%, 
                rgba(255, 223, 186, 0.3) 100%);
            border-color: rgba(255, 165, 0, 0.4);
        }

        .picker-wheel.time-picker:hover {
            border-color: rgba(255, 165, 0, 0.7);
        }

        .picker-wheel.time-picker .picker-option.selected {
            background: #ff8c00; /* æ©™è‰²é€‰ä¸­ */
            box-shadow: 0 2px 8px rgba(255, 140, 0, 0.3);
        }

        .picker-wheel:hover {
            border-color: rgba(102, 126, 234, 0.5);
        }

        /* æ‹¨ç›˜å†…éƒ¨å®¹å™¨ */
        .picker-wheel-inner {
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
            position: relative;
        }

        .picker-option {
            padding: 12px 6px;
            text-align: center;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.3s ease;
            color: #333;
            font-weight: 500;
            font-size: 16px;
            line-height: 1.2;
            user-select: none;
            height: 40px; /* å›ºå®šé«˜åº¦ */
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.4; /* éé€‰ä¸­é¡¹é€æ˜åº¦ */
        }

        .picker-option:hover {
            background: rgba(102, 126, 234, 0.1);
            opacity: 0.7;
        }

        .picker-option.selected {
            background: #667eea;
            color: white;
            font-weight: 600;
            font-size: 18px;
            opacity: 1; /* é€‰ä¸­é¡¹å®Œå…¨ä¸é€æ˜ */
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
            z-index: 10;
        }

        /* ä¸­å¿ƒæŒ‡ç¤ºçº¿ */
        .picker-wheel::before,
        .picker-wheel::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            height: 1px;
            background: rgba(102, 126, 234, 0.3);
            z-index: 5;
        }

        .picker-wheel::before {
            top: calc(50% - 20px); /* é€‰ä¸­åŒºåŸŸé¡¶éƒ¨çº¿ */
        }

        .picker-wheel::after {
            bottom: calc(50% - 20px); /* é€‰ä¸­åŒºåŸŸåº•éƒ¨çº¿ */
        }

        /* ç©ºç™½é€‰é¡¹æ ·å¼ */
        .picker-option.empty {
            pointer-events: none;
            opacity: 0;
        }

        .tags-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }

        .tag {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            padding: 8px 16px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tag:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .tag.selected {
            background: #667eea;
            border-color: #667eea;
            transform: scale(1.05);
        }

        .button {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            padding: 12px 30px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .result-card {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            text-align: left;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        /* ä¸¤åˆ—å¸ƒå±€æ ·å¼ */
        .two-column-layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .column {
            background: rgba(102, 126, 234, 0.05);
            border-radius: 10px;
            padding: 15px;
            border-left: 4px solid #667eea;
        }

        .column h4 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 1.1rem;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .two-column-layout {
                grid-template-columns: 1fr; /* ç§»åŠ¨ç«¯æ”¹ä¸ºå•åˆ— */
                gap: 15px;
            }
        }

        .result-section {
            margin: 15px 0;
            padding: 15px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .result-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 10px;
        }

        .result-content {
            line-height: 1.6;
            color: #555;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 40px;
            color: white;
            font-size: 18px;
        }

        .error {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            color: #ff6b6b;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }

        .section-title {
            color: white;
            font-size: 1.2rem;
            margin-bottom: 15px;
            text-align: center;
        }

        .selected-info {
            color: white;
            margin-top: 15px;
            font-size: 14px;
            opacity: 0.8;
            text-align: center;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .picker-container {
                flex-direction: column;
                align-items: center;
            }
            
            .picker-container-unified {
                flex-wrap: nowrap; /* å¼ºåˆ¶ä¸æ¢è¡Œ */
                gap: 8px;
                overflow-x: auto;
                justify-content: flex-start;
                padding: 10px 5px;
            }
            
            .picker-wheel {
                width: 60px;
                min-width: 60px;
                height: 100px;
                flex-shrink: 0;
            }
            
            .picker-wheel.year-picker {
                width: 65px;
                min-width: 65px;
            }
            
            .picker-wheel.narrow-picker {
                width: 50px;
                min-width: 50px;
            }
            
            .picker-option {
                padding: 8px 4px;
                font-size: 14px;
                height: 32px;
            }
            
            .picker-option.selected {
                font-size: 16px;
            }
            
            .separator {
                font-size: 20px;
                margin: 25px 4px 0 4px;
                flex-shrink: 0;
            }
            
            .picker-label {
                font-size: 12px;
            }
            
            .card {
                padding: 20px;
            }
            
            .two-column-layout {
                grid-template-columns: 1fr; /* ç§»åŠ¨ç«¯æ”¹ä¸ºå•åˆ— */
                gap: 15px;
            }
        }
        
        @media (max-width: 480px) {
            .picker-container-unified {
                flex-wrap: nowrap; /* ä»ç„¶ä¸æ¢è¡Œ */
                gap: 6px;
                overflow-x: auto;
                justify-content: flex-start;
                padding: 10px 2px;
            }
            
            .picker-wheel {
                width: 55px;
                min-width: 55px;
                height: 90px;
                flex-shrink: 0;
            }
            
            .picker-wheel.year-picker {
                width: 60px;
                min-width: 60px;
            }
            
            .picker-wheel.narrow-picker {
                width: 45px;
                min-width: 45px;
            }
            
            .separator {
                font-size: 18px;
                margin: 20px 2px 0 2px;
                flex-shrink: 0;
            }
            
            .picker-option {
                padding: 6px 2px;
                font-size: 12px;
                height: 28px;
            }
            
            .picker-option.selected {
                font-size: 14px;
            }
            
            .picker-label {
                font-size: 11px;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // APIé…ç½®å’Œå·¥å…·å‡½æ•°
        const API_ENDPOINTS = {
            BIRTHDAY: 'https://api.mxin.moe/api/v1/birthday',
            FORTUNE: 'http://api.suxun.site/api/constellation'
        };

        const CONSTELLATIONS = {
            'aries': { name: 'ç™½ç¾Šåº§', dates: '3.21-4.19' },
            'taurus': { name: 'é‡‘ç‰›åº§', dates: '4.20-5.20' }, 
            'gemini': { name: 'åŒå­åº§', dates: '5.21-6.21' },
            'cancer': { name: 'å·¨èŸ¹åº§', dates: '6.22-7.22' },
            'leo': { name: 'ç‹®å­åº§', dates: '7.23-8.22' },
            'virgo': { name: 'å¤„å¥³åº§', dates: '8.23-9.22' },
            'libra': { name: 'å¤©ç§¤åº§', dates: '9.23-10.23' },
            'scorpio': { name: 'å¤©èåº§', dates: '10.24-11.22' },
            'sagittarius': { name: 'å°„æ‰‹åº§', dates: '11.23-12.21' },
            'capricorn': { name: 'æ‘©ç¾¯åº§', dates: '12.22-1.19' },
            'aquarius': { name: 'æ°´ç“¶åº§', dates: '1.20-2.18' },
            'pisces': { name: 'åŒé±¼åº§', dates: '2.19-3.20' }
        };

        const TIME_RANGES = {
            'today': 'ä»Šå¤©',
            'nextday': 'æ˜å¤©', 
            'week': 'å‘¨',
            'month': 'æœˆ',
            'year': 'å¹´'
        };

        // APIå‡½æ•°
        const getBirthdayInfo = async (birthday, time = null) => {
            try {
                let url = `${API_ENDPOINTS.BIRTHDAY}?birthday=${birthday}`;
                if (time) {
                    url += `&time=${time}`;
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                if (data.code === 0) {
                    return { success: true, data: data.data };
                } else {
                    return { success: false, error: data.message || 'è·å–å¤±è´¥' };
                }
            } catch (error) {
                return { success: false, error: 'ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼š' + error.message };
            }
        };

        const getConstellation = async (type, time) => {
            try {
                const url = `${API_ENDPOINTS.FORTUNE}?type=${type}&time=${time}`;
                console.log('è¯·æ±‚URL:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('åŸå§‹APIå“åº”:', data);
                
                // å…¼å®¹æ•°å­—å’Œå­—ç¬¦ä¸²ç±»å‹çš„çŠ¶æ€ç 
                if (data.code === 200 || data.code === "200") {
                    console.log('è§£ææˆåŠŸï¼Œè¿”å›æ•°æ®:', data.data);
                    return { success: true, data: data.data };
                } else {
                    console.log('è§£æå¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯:', data.msg || data.message);
                    return { success: false, error: data.msg || data.message || 'è·å–è¿åŠ¿å¤±è´¥' };
                }
            } catch (error) {
                console.error('ç½‘ç»œè¯·æ±‚å¼‚å¸¸:', error);
                return { success: false, error: 'ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼š' + error.message };
            }
        };

        // æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ç»„ä»¶
        const DateTimePicker = ({ onDateTimeChange }) => {
            const [selectedYear, setSelectedYear] = useState(2000);
            const [selectedMonth, setSelectedMonth] = useState(1);
            const [selectedDay, setSelectedDay] = useState(1);
            const [selectedHour, setSelectedHour] = useState(12);
            const [selectedMinute, setSelectedMinute] = useState(0);

            const years = Array.from({ length: 75 }, (_, i) => 1950 + i);
            const months = Array.from({ length: 12 }, (_, i) => i + 1);
            const hours = Array.from({ length: 24 }, (_, i) => i);
            const minutes = Array.from({ length: 60 }, (_, i) => i);

            const getDaysInMonth = (year, month) => {
                return new Date(year, month, 0).getDate();
            };

            const days = Array.from({ length: getDaysInMonth(selectedYear, selectedMonth) }, (_, i) => i + 1);

            useEffect(() => {
                const maxDays = getDaysInMonth(selectedYear, selectedMonth);
                if (selectedDay > maxDays) {
                    setSelectedDay(maxDays);
                }
            }, [selectedYear, selectedMonth, selectedDay]);

            useEffect(() => {
                const birthday = `${selectedYear}-${selectedMonth.toString().padStart(2, '0')}-${selectedDay.toString().padStart(2, '0')}`;
                const time = `${selectedHour.toString().padStart(2, '0')}:${selectedMinute.toString().padStart(2, '0')}`;
                
                if (typeof onDateTimeChange === 'function') {
                    onDateTimeChange({ birthday, time });
                }
            }, [selectedYear, selectedMonth, selectedDay, selectedHour, selectedMinute]);

            const PickerWheel = ({ options, selected, onChange, label, isTimePicker = false, isYearPicker = false }) => {
                const selectedIndex = options.indexOf(selected);
                const wheelRef = useRef(null);
                const lastScrollTimeRef = useRef(0); // ä½¿ç”¨refç®¡ç†é˜²æŠ–æ—¶é—´
                
                // è·å–å½“å‰é€‰ä¸­é¡¹å‰åçš„é¡¹ç›®ï¼Œç¡®ä¿åªæ˜¾ç¤º3ä¸ª
                const getVisibleOptions = () => {
                    const result = [];
                    
                    // æŸ¥æ‰¾å½“å‰é€‰ä¸­é¡¹çš„ç´¢å¼•
                    let selectedIndex = -1;
                    for (let i = 0; i < options.length; i++) {
                        if (options[i] === selected) {
                            selectedIndex = i;
                            break;
                        }
                    }
                    
                    // ç”Ÿæˆä¸‰ä¸ªå¯è§é€‰é¡¹
                    for (let i = selectedIndex - 1; i <= selectedIndex + 1; i++) {
                        if (i >= 0 && i < options.length) {
                            result.push({
                                value: options[i],
                                index: i,
                                isSelected: i === selectedIndex
                            });
                        } else {
                            result.push({
                                value: '',
                                index: i,
                                isSelected: false,
                                isEmpty: true
                            });
                        }
                    }
                    
                    return result;
                };

                // æ”¹è¿›çš„æ»šè½®å¤„ç†
                const handleWheel = (e) => {
                    // ç«‹å³é˜»æ­¢äº‹ä»¶ä¼ æ’­
                    e.preventDefault();
                    e.stopPropagation();
                    e.stopImmediatePropagation();
                    
                    // é˜²æŠ–æœºåˆ¶ - ä½¿ç”¨çœŸå®æ—¶é—´æˆ³
                    const now = Date.now();
                    if (now - lastScrollTimeRef.current < 100) {
                        return false;
                    }
                    lastScrollTimeRef.current = now;
                    
                    // ç›´æ¥æ ¹æ®æ»šè½®æ–¹å‘å†³å®šæ“ä½œ
                    if (e.deltaY < 0) {
                        // å‘ä¸Šæ»šåŠ¨ - å‡å°å€¼
                        for (let i = 0; i < options.length; i++) {
                            if (options[i] === selected && i > 0) {
                                onChange(options[i - 1]);
                                break;
                            }
                        }
                    } else if (e.deltaY > 0) {
                        // å‘ä¸‹æ»šåŠ¨ - å¢å¤§å€¼
                        for (let i = 0; i < options.length; i++) {
                            if (options[i] === selected && i < options.length - 1) {
                                onChange(options[i + 1]);
                                break;
                            }
                        }
                    }
                    
                    return false;
                };

                const handleClick = (optionValue) => {
                    if (optionValue && optionValue !== selected) {
                        onChange(optionValue);
                    }
                };
                
                // é”®ç›˜æ”¯æŒï¼ˆä¸Šä¸‹ç®­å¤´é”®ï¼‰
                const handleKeyDown = (e) => {
                    if (e.key === 'ArrowUp') {
                        e.preventDefault();
                        let currentIndex = -1;
                        for (let i = 0; i < options.length; i++) {
                            if (options[i] === selected) {
                                currentIndex = i;
                                break;
                            }
                        }
                        if (currentIndex > 0) {
                            onChange(options[currentIndex - 1]);
                        }
                    } else if (e.key === 'ArrowDown') {
                        e.preventDefault();
                        let currentIndex = -1;
                        for (let i = 0; i < options.length; i++) {
                            if (options[i] === selected) {
                                currentIndex = i;
                                break;
                            }
                        }
                        if (currentIndex < options.length - 1 && currentIndex >= 0) {
                            onChange(options[currentIndex + 1]);
                        }
                    }
                };

                // æ·»åŠ æ»šè½®äº‹ä»¶ç›‘å¬å™¨
                useEffect(() => {
                    const wheelElement = wheelRef.current;
                    if (!wheelElement) return;
                    
                    const handleWheelCapture = (e) => {
                        // ç«‹å³é˜»æ­¢äº‹ä»¶ä¼ æ’­å’Œé»˜è®¤è¡Œä¸º
                        e.preventDefault();
                        e.stopPropagation();
                        e.stopImmediatePropagation();
                        
                        // è°ƒç”¨å®é™…çš„æ»šè½®å¤„ç†é€»è¾‘
                        handleWheel(e);
                        
                        return false;
                    };
                    
                    // åŒæ—¶æ·»åŠ æ•è·å’Œå†’æ³¡é˜¶æ®µçš„äº‹ä»¶ç›‘å¬
                    wheelElement.addEventListener('wheel', handleWheelCapture, { passive: false, capture: true });
                    wheelElement.addEventListener('wheel', handleWheelCapture, { passive: false, capture: false });
                    
                    return () => {
                        wheelElement.removeEventListener('wheel', handleWheelCapture, { capture: true });
                        wheelElement.removeEventListener('wheel', handleWheelCapture, { capture: false });
                    };
                }, [handleWheel]);

                const visibleOptions = getVisibleOptions();

                return (
                    <div className="picker-column">
                        <div className="picker-label">{label}</div>
                        <div 
                            ref={wheelRef}
                            className={`picker-wheel ${
                                isTimePicker ? 'time-picker' : ''
                            } ${
                                isYearPicker ? 'year-picker' : 'narrow-picker'
                            }`}
                            onKeyDown={handleKeyDown}
                            tabIndex={0} // è®©æ‹¨ç›˜å¯ä»¥è·å–ç„¦ç‚¹ï¼Œæ”¯æŒé”®ç›˜æ“ä½œ
                            role="listbox"
                            aria-label={`é€‰æ‹©${label}`}
                        >
                            <div className="picker-wheel-inner">
                                {visibleOptions.map((option, index) => (
                                    <div
                                        key={`${option.index}-${option.value}`}
                                        className={`picker-option ${
                                            option.isSelected ? 'selected' : ''
                                        } ${
                                            option.isEmpty ? 'empty' : ''
                                        }`}
                                        onClick={() => handleClick(option.value)}
                                        style={{
                                            visibility: option.isEmpty ? 'hidden' : 'visible'
                                        }}
                                        role="option"
                                        aria-selected={option.isSelected}
                                    >
                                        {option.value}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="datetime-picker">
                    <h3 className="section-title">æ˜Ÿåº§ ç”Ÿè¾°å…«å­—æŸ¥è¯¢</h3>
                    
                    <div className="unified-picker">
                        <h4 style={{ color: 'white', marginBottom: '15px', textAlign: 'center' }}>
                            å‡ºç”Ÿæ—¥æœŸ (å¿…å¡«) å’Œ å‡ºç”Ÿæ—¶é—´ (å¯é€‰)
                        </h4>
                        <div className="picker-container-unified">
                            <PickerWheel options={years} selected={selectedYear} onChange={setSelectedYear} label="å¹´" isYearPicker={true} />
                            <PickerWheel options={months} selected={selectedMonth} onChange={setSelectedMonth} label="æœˆ" />
                            <PickerWheel options={days} selected={selectedDay} onChange={setSelectedDay} label="æ—¥" />
                            <div className="separator">|</div>
                            <PickerWheel options={hours} selected={selectedHour} onChange={setSelectedHour} label="æ—¶" isTimePicker={true} />
                            <PickerWheel options={minutes} selected={selectedMinute} onChange={setSelectedMinute} label="åˆ†" isTimePicker={true} />
                        </div>
                    </div>

                    <div className="selected-info">
                        å·²é€‰æ‹©: {selectedYear}å¹´{selectedMonth}æœˆ{selectedDay}æ—¥ {selectedHour.toString().padStart(2, '0')}:{selectedMinute.toString().padStart(2, '0')}
                    </div>
                </div>
            );
        };

        // æ˜Ÿåº§é€‰æ‹©å™¨ç»„ä»¶
        const ConstellationSelector = ({ onSelectionChange }) => {
            const [selectedConstellation, setSelectedConstellation] = useState('');
            const [selectedTimeRange, setSelectedTimeRange] = useState('');

            const handleConstellationChange = (constellation) => {
                setSelectedConstellation(constellation);
                if (typeof onSelectionChange === 'function') {
                    onSelectionChange({ constellation, timeRange: selectedTimeRange });
                }
            };

            const handleTimeRangeChange = (timeRange) => {
                setSelectedTimeRange(timeRange);
                if (typeof onSelectionChange === 'function') {
                    onSelectionChange({ constellation: selectedConstellation, timeRange });
                }
            };

            return (
                <div className="constellation-selector">
                    <h3 className="section-title">æ˜Ÿåº§è¿åŠ¿æŸ¥è¯¢</h3>
                    
                    <div className="constellation-section">
                        <h4 style={{ color: 'white', marginBottom: '15px', textAlign: 'center' }}>é€‰æ‹©æ˜Ÿåº§</h4>
                        <div className="tags-container">
                            {Object.entries(CONSTELLATIONS).map(([key, constellation]) => (
                                <div
                                    key={key}
                                    className={`tag ${selectedConstellation === key ? 'selected' : ''}`}
                                    onClick={() => handleConstellationChange(key)}
                                    style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', padding: '10px 16px' }}
                                >
                                    <span style={{ fontSize: '16px', fontWeight: '600' }}>{constellation.name}</span>
                                    <span style={{ fontSize: '12px', opacity: '0.8', marginTop: '4px' }}>{constellation.dates}</span>
                                </div>
                            ))}
                        </div>
                    </div>

                    <div className="time-range-section">
                        <h4 style={{ color: 'white', margin: '30px 0 15px', textAlign: 'center' }}>é€‰æ‹©å‘¨æœŸ</h4>
                        <div className="tags-container">
                            {Object.entries(TIME_RANGES).map(([key, name]) => (
                                <div
                                    key={key}
                                    className={`tag ${selectedTimeRange === key ? 'selected' : ''}`}
                                    onClick={() => handleTimeRangeChange(key)}
                                >
                                    {name}
                                </div>
                            ))}
                        </div>
                    </div>

                    {selectedConstellation && selectedTimeRange && (
                        <div className="selected-info">
                            å·²é€‰æ‹©: {CONSTELLATIONS[selectedConstellation].name} - {TIME_RANGES[selectedTimeRange]}
                        </div>
                    )}
                </div>
            );
        };

        // ç»“æœå±•ç¤ºç»„ä»¶
        const ResultDisplay = ({ birthdayResult, fortuneResult }) => {
            if (!birthdayResult && !fortuneResult) {
                return null;
            }

            return (
                <div className="result-display">
                    {birthdayResult && (
                        <div className="result-card">
                            <h3 className="result-title">ğŸ”® æ˜Ÿåº§ä¸ç”Ÿè¾°å…«å­—</h3>
                            
                            <div className="two-column-layout">
                                <div className="column">
                                    <h4>åŸºæœ¬ä¿¡æ¯</h4>
                                    <div className="result-content">
                                        <p><strong>æ˜Ÿåº§ï¼š</strong>{birthdayResult.constellation}</p>
                                        <p><strong>ç”Ÿè‚–ï¼š</strong>{birthdayResult.zodiac}</p>
                                    </div>
                                </div>
                                
                                <div className="column">
                                    <h4>ç”Ÿè¾°å…«å­—</h4>
                                    <div className="result-content">
                                        <p><strong>å¹´æŸ±ï¼š</strong>{birthdayResult.bazi.year}</p>
                                        <p><strong>æœˆæŸ±ï¼š</strong>{birthdayResult.bazi.month}</p>
                                        <p><strong>æ—¥æŸ±ï¼š</strong>{birthdayResult.bazi.day}</p>
                                        <p><strong>æ—¶æŸ±ï¼š</strong>{birthdayResult.bazi.hour}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    {fortuneResult && (
                        <div className="result-card">
                            <h3 className="result-title">âœ¨ æ˜Ÿåº§è¿åŠ¿</h3>
                            
                            <div className="result-section">
                                <div className="result-title">è¿åŠ¿æ¦‚è§ˆ</div>
                                <div className="result-content">
                                    <p><strong>æ—¥æœŸï¼š</strong>{fortuneResult.date}</p>
                                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))', gap: '10px', marginTop: '10px' }}>
                                        <div><strong>ç»¼åˆè¿åŠ¿ï¼š</strong>{fortuneResult.all}</div>
                                        <div><strong>çˆ±æƒ…è¿åŠ¿ï¼š</strong>{fortuneResult.love}</div>
                                        <div><strong>å·¥ä½œè¿åŠ¿ï¼š</strong>{fortuneResult.work}</div>
                                        <div><strong>è´¢è¿è¿åŠ¿ï¼š</strong>{fortuneResult.money}</div>
                                        <div><strong>å¥åº·è¿åŠ¿ï¼š</strong>{fortuneResult.health}</div>
                                        <div><strong>è®¨è®ºè¿åŠ¿ï¼š</strong>{fortuneResult.discuss}</div>
                                    </div>
                                </div>
                            </div>

                            <div className="result-section">
                                <div className="result-title">å¹¸è¿ä¿¡æ¯</div>
                                <div className="result-content">
                                    <p><strong>å¹¸è¿é¢œè‰²ï¼š</strong>{fortuneResult.lucky_color}</p>
                                    <p><strong>å¹¸è¿æ•°å­—ï¼š</strong>{fortuneResult.lucky_number}</p>
                                    <p><strong>å¹¸è¿æ˜Ÿåº§ï¼š</strong>{fortuneResult.lucky_star}</p>
                                </div>
                            </div>

                            <div className="result-section">
                                <div className="result-title">ä»Šæ—¥å®œå¿Œ</div>
                                <div className="result-content">
                                    <p><strong>å®œï¼š</strong>{fortuneResult.yi}</p>
                                    <p><strong>å¿Œï¼š</strong>{fortuneResult.ji}</p>
                                    <p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong>{fortuneResult.notice}</p>
                                </div>
                            </div>

                            <div className="result-section">
                                <div className="result-title">è¯¦ç»†è§£æ</div>
                                <div className="result-content">
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>æ•´ä½“è¿åŠ¿ï¼š</strong>
                                        <p style={{ marginTop: '5px', lineHeight: '1.6' }}>{fortuneResult.all_text}</p>
                                    </div>
                                    
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>çˆ±æƒ…è¿åŠ¿ï¼š</strong>
                                        <p style={{ marginTop: '5px', lineHeight: '1.6' }}>{fortuneResult.love_text}</p>
                                    </div>
                                    
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>å·¥ä½œè¿åŠ¿ï¼š</strong>
                                        <p style={{ marginTop: '5px', lineHeight: '1.6' }}>{fortuneResult.work_text}</p>
                                    </div>
                                    
                                    <div style={{ marginBottom: '15px' }}>
                                        <strong>è´¢è¿åˆ†æï¼š</strong>
                                        <p style={{ marginTop: '5px', lineHeight: '1.6' }}>{fortuneResult.money_text}</p>
                                    </div>
                                    
                                    <div>
                                        <strong>å¥åº·å»ºè®®ï¼š</strong>
                                        <p style={{ marginTop: '5px', lineHeight: '1.6' }}>{fortuneResult.health_text}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // ä¸»åº”ç”¨ç»„ä»¶
        const App = () => {
            const [dateTime, setDateTime] = useState({ birthday: '', time: '' });
            const [constellation, setConstellation] = useState({ constellation: '', timeRange: '' });
            const [birthdayResult, setBirthdayResult] = useState(null);
            const [fortuneResult, setFortuneResult] = useState(null);
            const [birthdayLoading, setBirthdayLoading] = useState(false);
            const [fortuneLoading, setFortuneLoading] = useState(false);
            const [error, setError] = useState('');

            const handleDateTimeChange = (newDateTime) => {
                setDateTime(newDateTime);
            };

            const handleConstellationChange = (newConstellation) => {
                setConstellation(newConstellation);
            };

            const handleGetBirthdayInfo = async () => {
                if (!dateTime.birthday) {
                    setError('è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ');
                    return;
                }

                setBirthdayLoading(true);
                setError('');
                
                try {
                    const result = await getBirthdayInfo(dateTime.birthday, dateTime.time);
                    if (result.success) {
                        setBirthdayResult(result.data);
                        setError('');
                    } else {
                        setError(result.error);
                        setBirthdayResult(null);
                    }
                } catch (err) {
                    setError('è·å–æ˜Ÿåº§ä¿¡æ¯å¤±è´¥ï¼š' + err.message);
                    setBirthdayResult(null);
                } finally {
                    setBirthdayLoading(false);
                }
            };

            const handleGetFortune = async () => {
                if (!constellation.constellation || !constellation.timeRange) {
                    setError('è¯·é€‰æ‹©æ˜Ÿåº§å’Œæ—¶é—´èŒƒå›´');
                    return;
                }

                console.log('å¼€å§‹æŸ¥è¯¢è¿åŠ¿:', constellation);
                setFortuneLoading(true);
                setError('');
                
                try {
                    const result = await getConstellation(constellation.constellation, constellation.timeRange);
                    console.log('è¿åŠ¿æŸ¥è¯¢ç»“æœ:', result);
                    if (result.success) {
                        // æ ¹æ®æ—¶é—´èŒƒå›´è·å–å¯¹åº”çš„æ•°æ®
                        let targetData = result.data;
                        const timeRange = constellation.timeRange;
                        
                        // æ˜ å°„å…³ç³»ï¼štoday -> day, nextday -> tomorrow, week -> week, month -> month, year -> year
                        if (timeRange === 'today') {
                            targetData = result.data.day || result.data;
                        } else if (timeRange === 'nextday') {
                            targetData = result.data.tomorrow || result.data;
                        } else if (timeRange === 'week') {
                            targetData = result.data.week || result.data;
                        } else if (timeRange === 'month') {
                            targetData = result.data.month || result.data;
                        } else if (timeRange === 'year') {
                            targetData = result.data.year || result.data;
                        }
                        
                        // åœ¨ç»“æœä¸­æ·»åŠ æ—¶é—´èŒƒå›´ä¿¡æ¯ï¼Œç”¨äºæ˜¾ç¤º
                        targetData.selectedTimeRange = constellation.timeRange;
                        
                        setFortuneResult(targetData);
                        console.log('è¿åŠ¿æ•°æ®è®¾ç½®æˆåŠŸ:', targetData);
                        setError('');
                    } else {
                        console.log('è¿åŠ¿æŸ¥è¯¢å¤±è´¥:', result.error);
                        setError(result.error);
                        setFortuneResult(null);
                    }
                } catch (err) {
                    console.error('è¿åŠ¿æŸ¥è¯¢å¼‚å¸¸:', err);
                    setError('è·å–è¿åŠ¿ä¿¡æ¯å¤±è´¥ï¼š' + err.message);
                    setFortuneResult(null);
                } finally {
                    setFortuneLoading(false);
                    console.log('è¿åŠ¿æŸ¥è¯¢ç»“æŸ');
                }
            };

            const clearResults = () => {
                setBirthdayResult(null);
                setFortuneResult(null);
                setError('');
            };

            return (
                <div className="app">
                    <div className="container">
                        <h1 className="title">ğŸŒŸ æ˜Ÿåº§è¿åŠ¿æŸ¥è¯¢ ğŸŒŸ</h1>
                        
                        {/* æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ */}
                        <div className="card">
                            <DateTimePicker onDateTimeChange={handleDateTimeChange} />
                            <div style={{ textAlign: 'center', display: 'flex', justifyContent: 'center', gap: '15px', flexWrap: 'wrap' }}>
                                <button 
                                    className="button" 
                                    onClick={handleGetBirthdayInfo}
                                    disabled={birthdayLoading || !dateTime.birthday}
                                >
                                    {birthdayLoading ? 'æŸ¥è¯¢ä¸­...' : 'æŸ¥è¯¢æ˜Ÿåº§'}
                                </button>
                                <button 
                                    className="button" 
                                    onClick={clearResults}
                                    style={{ background: 'rgba(255, 255, 255, 0.2)' }}
                                >
                                    æ¸…é™¤ç»“æœ
                                </button>
                            </div>
                            
                            {/* æ˜Ÿåº§ä¸ç”Ÿè¾°å…«å­—ç»“æœæ˜¾ç¤ºåœ¨æŸ¥è¯¢æŒ‰é’®ä¸‹æ–¹ */}
                            {birthdayResult && (
                                <div className="result-card" style={{ marginTop: '20px' }}>
                                    <h3 className="result-title">ğŸ”® æ˜Ÿåº§ä¸ç”Ÿè¾°å…«å­—</h3>
                                    
                                    <div className="two-column-layout">
                                        <div className="column">
                                            <h4>åŸºæœ¬ä¿¡æ¯</h4>
                                            <div className="result-content">
                                                <p><strong>æ˜Ÿåº§ï¼š</strong>{birthdayResult.constellation}</p>
                                                <p><strong>ç”Ÿè‚–ï¼š</strong>{birthdayResult.zodiac}</p>
                                            </div>
                                        </div>
                                        
                                        <div className="column">
                                            <h4>ç”Ÿè¾°å…«å­—</h4>
                                            <div className="result-content">
                                                <p><strong>å¹´æŸ±ï¼š</strong>{birthdayResult.bazi.year}</p>
                                                <p><strong>æœˆæŸ±ï¼š</strong>{birthdayResult.bazi.month}</p>
                                                <p><strong>æ—¥æŸ±ï¼š</strong>{birthdayResult.bazi.day}</p>
                                                <p><strong>æ—¶æŸ±ï¼š</strong>{birthdayResult.bazi.hour}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>

                        {/* æ˜Ÿåº§é€‰æ‹©å™¨ */}
                        <div className="card">
                            <ConstellationSelector onSelectionChange={handleConstellationChange} />
                            <div style={{ textAlign: 'center' }}>
                                <button 
                                    className="button" 
                                    onClick={handleGetFortune}
                                    disabled={fortuneLoading || !constellation.constellation || !constellation.timeRange}
                                >
                                    {fortuneLoading ? 'æŸ¥è¯¢ä¸­...' : 'æŸ¥è¯¢è¿åŠ¿'}
                                </button>
                            </div>
                            
                            {/* è¿åŠ¿ç»“æœæ˜¾ç¤ºåœ¨æŸ¥è¯¢è¿åŠ¿æŒ‰é’®ä¸‹æ–¹ */}
                            {fortuneResult && (
                                <div className="result-card" style={{ marginTop: '20px' }}>
                                    <h3 className="result-title">âœ¨ æ˜Ÿåº§è¿åŠ¿ - {TIME_RANGES[fortuneResult.selectedTimeRange] || 'è¿åŠ¿'}</h3>
                                    
                                    <div className="result-section">
                                        <div className="result-title">è¿åŠ¿æ¦‚è§ˆ</div>
                                        <div className="result-content">
                                            <p><strong>æ—¥æœŸï¼š</strong>{fortuneResult.date || 'ä»Šæ—¥'}</p>
                                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(120px, 1fr))', gap: '10px', marginTop: '10px' }}>
                                                <div><strong>ç»¼åˆè¿åŠ¿ï¼š</strong>{fortuneResult.all || 'æš‚æ— æ•°æ®'}</div>
                                                <div><strong>çˆ±æƒ…è¿åŠ¿ï¼š</strong>{fortuneResult.love || 'æš‚æ— æ•°æ®'}</div>
                                                <div><strong>å·¥ä½œè¿åŠ¿ï¼š</strong>{fortuneResult.work || 'æš‚æ— æ•°æ®'}</div>
                                                <div><strong>è´¢è¿è¿åŠ¿ï¼š</strong>{fortuneResult.money || 'æš‚æ— æ•°æ®'}</div>
                                                <div><strong>å¥åº·è¿åŠ¿ï¼š</strong>{fortuneResult.health || 'æš‚æ— æ•°æ®'}</div>
                                                {/* å‘¨ã€æœˆã€å¹´æ—¶éšè—è®¨è®ºè¿åŠ¿ */}
                                                {fortuneResult.selectedTimeRange !== 'week' && fortuneResult.selectedTimeRange !== 'month' && fortuneResult.selectedTimeRange !== 'year' && (
                                                    <div><strong>è®¨è®ºè¿åŠ¿ï¼š</strong>{fortuneResult.discuss || 'æš‚æ— æ•°æ®'}</div>
                                                )}
                                            </div>
                                        </div>
                                    </div>

                                    {/* å‘¨ã€æœˆã€å¹´æ—¶éšè—å¹¸è¿ä¿¡æ¯ */}
                                    {fortuneResult.selectedTimeRange !== 'week' && fortuneResult.selectedTimeRange !== 'month' && fortuneResult.selectedTimeRange !== 'year' && (
                                        <div className="result-section">
                                            <div className="result-title">å¹¸è¿ä¿¡æ¯</div>
                                            <div className="result-content">
                                                <p><strong>å¹¸è¿é¢œè‰²ï¼š</strong>{fortuneResult.lucky_color || 'æš‚æ— æ•°æ®'}</p>
                                                <p><strong>å¹¸è¿æ•°å­—ï¼š</strong>{fortuneResult.lucky_number || 'æš‚æ— æ•°æ®'}</p>
                                                <p><strong>å¹¸è¿æ˜Ÿåº§ï¼š</strong>{fortuneResult.lucky_star || 'æš‚æ— æ•°æ®'}</p>
                                            </div>
                                        </div>
                                    )}

                                    <div className="result-section">
                                        <div className="result-title">{fortuneResult.selectedTimeRange === 'today' || fortuneResult.selectedTimeRange === 'nextday' ? 'ä»Šæ—¥å®œå¿Œ' : 'å®œå¿Œ'}</div>
                                        <div className="result-content">
                                            <p><strong>å®œï¼š</strong>{fortuneResult.yi || 'æš‚æ— æ•°æ®'}</p>
                                            <p><strong>å¿Œï¼š</strong>{fortuneResult.ji || 'æš‚æ— æ•°æ®'}</p>
                                            <p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong>{fortuneResult.notice || 'æš‚æ— æ•°æ®'}</p>
                                        </div>
                                    </div>

                                    <div className="result-section">
                                        <div className="result-title">è¯¦ç»†è§£æ</div>
                                        <div className="result-content">
                                            <div style={{ marginBottom: '15px' }}>
                                                <strong>æ•´ä½“è¿åŠ¿ï¼š</strong>
                                                <p style={{ marginTop: '5px', lineHeight: '1.6' }}>{fortuneResult.all_text || 'æš‚æ— è¯¦ç»†è§£æ'}</p>
                                            </div>
                                            
                                            <div style={{ marginBottom: '15px' }}>
                                                <strong>çˆ±æƒ…è¿åŠ¿ï¼š</strong>
                                                <p style={{ marginTop: '5px', lineHeight: '1.6' }}>{fortuneResult.love_text || 'æš‚æ— è¯¦ç»†è§£æ'}</p>
                                            </div>
                                            
                                            <div style={{ marginBottom: '15px' }}>
                                                <strong>å·¥ä½œè¿åŠ¿ï¼š</strong>
                                                <p style={{ marginTop: '5px', lineHeight: '1.6' }}>{fortuneResult.work_text || 'æš‚æ— è¯¦ç»†è§£æ'}</p>
                                            </div>
                                            
                                            <div style={{ marginBottom: '15px' }}>
                                                <strong>è´¢è¿åˆ†æï¼š</strong>
                                                <p style={{ marginTop: '5px', lineHeight: '1.6' }}>{fortuneResult.money_text || 'æš‚æ— è¯¦ç»†è§£æ'}</p>
                                            </div>
                                            
                                            <div>
                                                <strong>å¥åº·å»ºè®®ï¼š</strong>
                                                <p style={{ marginTop: '5px', lineHeight: '1.6' }}>{fortuneResult.health_text || 'æš‚æ— è¯¦ç»†è§£æ'}</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>



                        {/* é”™è¯¯ä¿¡æ¯ */}
                        {error && (
                            <div className="error">
                                {error}
                            </div>
                        )}

                        {/* åŠ è½½çŠ¶æ€ */}
                        {(birthdayLoading || fortuneLoading) && (
                            <div className="loading">
                                <div>æ­£åœ¨æŸ¥è¯¢ä¸­ï¼Œè¯·ç¨å€™...</div>
                            </div>
                        )}

                        {/* è¿åŠ¿ç»“æœå±•ç¤ºåŒºåŸŸå·²ç§»è‡³æ˜Ÿåº§é€‰æ‹©å™¨å¡ç‰‡å†…éƒ¨ */}

                        {/* ç‰ˆæƒä¿¡æ¯ */}
                        <div className="card" style={{ marginTop: '40px', fontSize: '14px', opacity: 0.8, textAlign: 'center' }}>
                            <div style={{ color: 'white', lineHeight: '1.6' }}>
                                <p style={{ fontSize: '16px', marginBottom: '10px' }}>âœ¨ æ˜Ÿåº§è¿åŠ¿æŸ¥è¯¢ç³»ç»Ÿ âœ¨</p>
                                <p style={{ fontSize: '12px', opacity: '0.7' }}>Â© 2025 Ajeo æ˜Ÿåº§è¿åŠ¿ | ä»…ä¾›å¨±ä¹å‚è€ƒï¼Œè¯·å‹¿è¿‡åº¦è¿·ä¿¡</p>
                                <p style={{ fontSize: '11px', opacity: '0.6', marginTop: '5px' }}>æ•°æ®æ¥æºäºä¸“ä¸šæ˜Ÿåº§APIæ¥å£</p>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // æ¸²æŸ“åº”ç”¨
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>